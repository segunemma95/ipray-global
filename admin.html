<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - iPray Global</title>
<link rel="stylesheet" href="style.css">
</head>

<body>
<h2>ðŸ“Š iPray Global Registration Dashboard</h2>
<p>Total Registrations: <span id="total">Loading...</span></p>

<table border="1">
    <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Country</th>
        <th>Date</th>
    </tr>
    <tbody id="tableBody"></tbody>
</table>

<button onclick="downloadCSV()">Download CSV</button>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDyzpL55SSiDRcPt6Hm8IK07k79a11bmDI",
        authDomain: "ipray-global.firebaseapp.com",
        databaseURL: "https://ipray-global-default-rtdb.firebaseio.com",
        projectId: "ipray-global",
        storageBucket: "ipray-global.firebasestorage.app",
        messagingSenderId: "762667869397",
        appId: "1:762667869397:web:5ac930cb9a9190b57e2e5c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tableBody = document.getElementById("tableBody");
    const totalDisplay = document.getElementById("total");

    const usersRef = ref(db, "registrations");
    onValue(usersRef, (snapshot) => {
        tableBody.innerHTML = "";
        let count = 0;

        snapshot.forEach((child) => {
            const data = child.val();
            count++;

            const row = `<tr>
                <td>${data.name}</td>
                <td>${data.email}</td>
                <td>${data.country}</td>
                <td>${data.timestamp}</td>
            </tr>`;
            tableBody.innerHTML += row;
        });

        totalDisplay.textContent = count;
    });

    function downloadCSV() {
        let csv = "Name,Email,Country,Date\n";
        const rows = tableBody.querySelectorAll("tr");

        rows.forEach(row => {
            const cols = row.querySelectorAll("td");
            const data = [...cols].map(td => td.innerText).join(",");
            csv += data + "\n";
        });

        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.setAttribute("href", url);
        a.setAttribute("download", "ipray_registrations.csv");
        a.click();
    }
</script>

</body>
</html>
